<!-- markdownlint-disable MD033 -->
<!-- markdownlint-disable MD010 -->
<!-- markdownlint-disable MD037 -->

# 彙總與排序

## <font size = 6>查詢時彙總資料</font>

* 計算資料表欄位的總計值或平均值等統計操作, 需要利用彙總函數(Aggregate Function、Group Function)
* 彙總函數基本上會排除 NULL, 不過 COUNT 如果不特別指定含有NULL的 col 而是使用 COUNT(*) 的話, 就不會排除 NULL, 就算資料只有 NULL 也是. 當然在 WHERE 上的條件會先排除.
* 排除重複值進行統計時, 需使用 DISTINCT

### <font size = 5>常用的彙總函數</font>

* COUNT：計算指定欄位中的記錄數量。
* SUM：計算指定欄位的數值總和。
* AVG：計算指定欄位的數值平均值。
* MAX：找出指定欄位中的最大值。
* MIN：找出指定欄位中的最小值

使用方法

```SQL
SELECT COUNT(column_name)
    FROM shohin
```

例子1 : 列出資料總比數、總賣價、總買價、總利潤、平均利潤、最大價差、最小價差和最後購買日期, <font color = red>不排除買賣價個含有NULL的資料</font>.

```SQL
SELECT COUNT(*) AS "總比數", 
       SUM(sell_price) AS "總賣價",
       SUM(buying_price) AS "總買價",
       SUM(sell_price - buying_price) AS "總利潤",
       AVG(sell_price - buying_price) AS "平均利潤",
       /*
       如果 AVG 這行寫成 AVG(sell_price) - AVG(buying_price) 結果會不一樣,
       因為 AVG(sell_price) 沒有把 buying_price 上的 NULL 無視. 
       */
       MAX(sell_price - buying_price) AS "最大價差",
       MIN(sell_price - buying_price) AS "最小價差",
       MAX(reg_date) AS "最後購買日期"
    FROM shohin;
```

![輸出結果](https://imgur.com/o70I3Gi.jpg)

例子2 : 列出資料總比數、總賣價、總買價、總利潤、平均利潤、最大價差和最小價差, <font color = red>排除買賣價個含有NULL的資料</font>.

```SQL
SELECT COUNT(*) AS "總比數", 
       SUM(sell_price) AS "總賣價",
       SUM(buying_price) AS "總買價",
       SUM(sell_price - buying_price) AS "總利潤",
       AVG(sell_price - buying_price) AS "平均利潤",
       /*
       如果 AVG 這行寫成 AVG(sell_price) - AVG(buying_price) 結果會一樣, 因為後面 WHERE 把 NULL 無視了
       */
       MAX(sell_price - buying_price) AS "最大價差",
       MIN(sell_price - buying_price) AS "最小價差",
       MAX(reg_date) AS "最後購買日期"
    FROM shohin
    WHERE (sell_price IS NOT NULL) AND (buying_price IS NOT NULL);
```

![輸出結果](https://imgur.com/HDPvuef.jpg)

<font size = 4 color = orange> 上面可以發現, 除了COUNT, 其他函數會自動排除該 col 有 NULL 的結果, AVG 也是直接對 NULL 無視.</font>

---

### <font size = 5>使用彙總函數時先排除重複值 : 使用 DISTINCT</font>

```SQL
SELECT COUNT(DISTINCT(<欄位名稱>))
    FROM <資料表名稱>
```

例子 : 計算資料量、資料總類數

```SQL
SELECT COUNT(*) AS "資料總數量",
       COUNT(DISTINCT(shohin_catalg)) AS "資料總類數"
    FROM shohin
```

![輸出結果](https://imgur.com/Q6ieRZn.jpg)