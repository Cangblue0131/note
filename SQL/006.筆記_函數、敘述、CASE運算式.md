<!-- markdownlint-disable MD033 -->
<!-- markdownlint-disable MD010 -->
<!-- markdownlint-disable MD037 -->

# 函數、敘述、CASE運算式

## <font size = 6>各式各樣的函數</font>

* 函數按照其用途類別, 大致上可分為數學函數、字串函數、日期函數、轉換函數以及彙總函數等類型
* 由於函數的數量過多, 建議先記較長使用的函數, 其他需要時再查詢即可.
* <font color = red>WHERE 後面雖然不能放彙總函數 (因為WHERE子句用於過濾記錄，而彙總函數用於計算資料的彙總值。), 但是其他的函數可以使用.</font>

### <font size = 5>數學函數</font>

用來計算數值的函數,例如+ - * / 也是數學函數.

為了更方便表示數學函數, 新增以下表

```SQL
-- DDL : 建立資料表, 用於學習數學函數
CREATE TABLE SampleMath(
    m   NUMERIC (10,3), -- 用於指定數值大小 NUMERIC(整數位數, 小數位數)
    n   INTEGER ,
    p   INTEGER 
);

-- DML : 存入資料
START TRANSACTION;

INSERT INTO SampleMath(m, n, p) VALUES (500, 0 ,NULL);
INSERT INTO SampleMath(m, n, p) VALUES (-180, 0,    NULL);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, NULL, NULL);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 7,    3);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 5,    2);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 4,    NULL);
INSERT INTO SampleMath(m, n, p) VALUES (8,    NULL, 3);
INSERT INTO SampleMath(m, n, p) VALUES (2.27, 1,    NULL);
INSERT INTO SampleMath(m, n, p) VALUES (5.555,2,    NULL);
INSERT INTO SampleMath(m, n, p) VALUES (NULL, 1,    NULL);
INSERT INTO SampleMath(m, n, p) VALUES (8.76, NULL, NULL);

COMMIT;
```

### <font size = 4> ABS - 絕對值</font>

```SQL
ABS(數值)
```

### <font size = 4> MOD - 餘數</font>

MOD 會計算餘數, 但是只能適用於整數類別的欄位

```SQL
MOD(被除數, 除數)
```

### <font size = 4> ROUND - 四捨五入</font>

```SQL
ROUND(目標, 小數位數)
```

例子 : 利用剛剛建立的資料表, 計算 m 的絕對值、n 除以 p 的餘數、m 的值做四捨五入到第 n 位.

```SQL
SELECT
    m,
    ABS(m) AS ABS_m,
    n,
    p,
    MOD(n,p) AS MOD_n_p,
    ROUND(m,n) AS ROUND_m_n
FROM
    SampleMath;
```

![結果](https://imgur.com/q5dsLLM.jpg)

---

## <font size = 5>字串函數</font>

用來操作字串的函數.

建立練習用資料表

```SQL
-- DDL：建立資料表
CREATE TABLE SampleStr
(str1  VARCHAR(40),
 str2  VARCHAR(40),
 str3  VARCHAR(40));

-- DML：存入資料
START TRANSACTION;

INSERT INTO SampleStr (str1, str2, str3) VALUES ('一二三',	'四五'	,	NULL);
INSERT INTO SampleStr (str1, str2, str3) VALUES ('abc'	,	'def'	,	NULL);
INSERT INTO SampleStr (str1, str2, str3) VALUES ('山田'	,	'太郎'	,	'是也');
INSERT INTO SampleStr (str1, str2, str3) VALUES ('aaa'	,	NULL	,	NULL);
INSERT INTO SampleStr (str1, str2, str3) VALUES (NULL	,	'甲乙丙',	NULL);
INSERT INTO SampleStr (str1, str2, str3) VALUES ('@!#$%',	NULL	,	NULL);
INSERT INTO SampleStr (str1, str2, str3) VALUES ('ABC'	,	NULL	,	NULL);
INSERT INTO SampleStr (str1, str2, str3) VALUES ('aBC'	,	NULL	,	NULL);
INSERT INTO SampleStr (str1, str2, str3) VALUES ('abc太郎',	'abc'	,	'ABC');
INSERT INTO SampleStr (str1, str2, str3) VALUES ('abcdefabc',	'abc'	,	'ABC');
INSERT INTO SampleStr (str1, str2, str3) VALUES ('言必信行必果','必'	,	'不');

COMMIT;
```

### <font size = 4> CONCAT - 字串連接</font>

```SQL
CONCAT('字串1', '字串2', ...)
```

### <font size = 4> LENGTH - 字串長度</font>

注 : mySQL 使用 LENGTH 計算長度是以位元組當作單位, 所以以 LENGTH 計算中文的字串長度時, 不會以中文字數當作回傳值.

```SQL
LENGTH('字串')
```

### <font size = 4> CHAR_LENGTH - mySQL 計算文字長度</font>

```SQL
CHAR_LENGTH('字串')
```

### <font size = 4> LOWER - 轉換為小寫</font>

若使用時含有英文字母以外的字, 則只有英文字會改變.

```SQL
LOWER('字串')
```

### <font size = 4> UPPER - 轉換為大寫</font>

```SQL
UPPER('字串')
```

例子 : 利用上面建立的資料表, 將 str1 和 str3 合併, 然後計算合併的長度, 再將英文全部轉成小寫和大寫.

```SQL
SELECT
    str1,
    str3,
    CONCAT(str1, str3) AS '使用CONCAT合併str1,str3',
    LENGTH(CONCAT(str1, str3)) AS '使用LENGTH計算合併後的字串長度',
    CHAR_LENGTH(CONCAT(str1, str3)) AS '使用 CHAR_LENGTH 計算合併後的字串長度',
    LOWER(CONCAT(str1, str3)) AS '將合併後的字串全部轉成小寫',
    UPPER(CONCAT(str1, str3)) AS '將合併後的字串全部轉成大寫'
FROM
    SampleStr;
```

![結果](https://imgur.com/qSsdDaQ.jpg)

```SQL
-- 同上, 如果不想看 NULL 的結果, 可以改成這樣
SELECT
    str1,
    str3,
    CONCAT(str1, str3) AS '使用CONCAT合併str1,str3',
    LENGTH(CONCAT(str1, str3)) AS '使用LENGTH計算合併後的字串長度',
    CHAR_LENGTH(CONCAT(str1, str3)) AS '使用 CHAR_LENGTH 計算合併後的字串長度',
    LOWER(CONCAT(str1, str3)) AS '將合併後的字串全部轉成小寫',
    UPPER(CONCAT(str1, str3)) AS '將合併後的字串全部轉成大寫'
FROM
    SampleStr AS S1
WHERE
	CONCAT(str1, str3) IS NOT NULL; -- WHERE 後面雖然不能放彙總函數, 但是其他的可以放.
```

![結果](https://imgur.com/d0BXXue.jpg)

### <font size = 4> REPLACE - 字串置換</font>

將 "置換對象" 中的 "置換目標" 轉變成 "置換結果"

```SQL
REPLACE('置換對象', '置換目標', '置換結果')
```

### <font size = 4> SUBSTRING - 字串擷取</font>

```SQL
SUBSTRING('擷取對象字串' FROM '擷取開始位置' FOR '擷取文字數量')
```

例子 : 利用上面建立的資料表, 將 str1 中的 str2 置換成 str3、 印出 str1 從第三個字開始的兩個字.

```SQL
SELECT
    str1,
    str2,
    str3,
    REPLACE(str1, str2, str3),
    SUBSTRING(str1 FROM 3 FOR 2)
FROM
    SampleStr;
```

![結果](https://imgur.com/u7lSse4.jpg)

---

