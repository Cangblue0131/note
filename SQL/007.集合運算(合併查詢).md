<!-- markdownlint-disable MD033 -->
<!-- markdownlint-disable MD010 -->
<!-- markdownlint-disable MD037 -->

# 集合運算(合併查詢)

## <font size = 6>資料表的加法與減法運算</font>

* 所謂的集合運算是對多筆紀錄進行相加或相減的動作, 可以說是紀錄的四則運算.
* 進行集合運算的時候, 會使用 UNION(聯集)、INTERSECT(交集) 和 EXCEPT(差集) 等集合運算子.
* 集合運算子預設會排除重複的紀錄
* 使用集合運算子的時候, 如果想列出重複的紀錄, 須加上 ALL 選項.
* <font color = orange>注意事項 P.7-6 :
  * 欄位數量必須相同
  * 對應欄位的資料型別必須一致. P.7-6</font >
  * SELECT 敘述可以寫入各種子句, 但 ORDER BY 子句只能寫在最後一處.

建立練習用資料表

```SQL
CREATE TABLE Shohin2(
    shohin_id     	 CHAR(4)      NOT NULL,
    shohin_name     VARCHAR(100) NOT NULL,
    shohin_catalg 	 VARCHAR(32)  NOT NULL,
    sell_price  	 INTEGER      ,
    buying_price  	 INTEGER      ,
    reg_date      	 DATE         ,
    PRIMARY KEY (shohin_id)
);

-- MySQL
START TRANSACTION;

INSERT INTO Shohin2 VALUES ('0001', 'T侐', '衣物', 1000, 500, '2009-09-20');
INSERT INTO Shohin2 VALUES ('0002', '打孔機', '辦公用品', 500, 320, '2009-09-11');
INSERT INTO Shohin2 VALUES ('0003', '襯衫', '衣物', 4000, 2800, NULL);
INSERT INTO Shohin2 VALUES ('0009', '手套', '衣物', 800, 500, NULL);
INSERT INTO Shohin2 VALUES ('0010', '水壺', '廚房用品', 2000, 1700, '2009-09-20');

COMMIT;
```

例子 : 查看 shohin 和 shohin2 的商品編號跟商品全部有哪些, 編號以降冪排序, 並且排除重複項目.

```SQL
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin
UNION -- 如果不排除重複項目, 則這裡加上ALL
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin2
ORDER BY 
    shohin_id DESC;
```

![結果](https://imgur.com/W4YbZXx.jpg)

例子 : 篩選出 Shohin 和 Shohin2 相同的商品編號和商品.

```SQL
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin
INTERSECT -- mySQL 沒有交集的指令(不過我放上去好像能跑?)
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin2;
```

```SQL
-- 使用 EXISTS 建立交集
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin AS S1
WHERE EXISTS (
                SELECT *
                FROM Shohin2 AS S2
                WHERE S1.shohin_id = S2.shohin_id
             );
```

![結果](https://imgur.com/xWVvhzd.jpg)

例子 : 列出 Shohin 有 但是 Shohin2 沒有的商品和其編號.

```SQL
-- 使用 EXCEPT
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin
EXCEPT -- mySQL 好像不能使用, 不過我放上去能跑就是.
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin2;
```

```SQL
-- 使用 IN 寫上述例子
SELECT
    shohin_id,
    shohin_name
FROM
    Shohin
WHERE
    shohin_id NOT IN   (
                    SELECT
                        shohin_id
                    FROM
                        Shohin2
                    );
```

![結果](https://imgur.com/Yz0s5Xi.jpg)
