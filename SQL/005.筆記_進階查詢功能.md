<!-- markdownlint-disable MD033 -->
<!-- markdownlint-disable MD010 -->
<!-- markdownlint-disable MD037 -->

# 進階查詢功能

## <font size = 6>檢視表 p.5-3</font>

* 檢視表和資料表相似, 差別在於資料表儲存著「實際的資料」, 而檢視表儲存的是「SELECT 敘述」, 所以能節省儲存裝置的容量.
* 運用檢視表的功能, 對於所需資料存放於多個資料表之類的狀況, 亦能輕鬆完成複雜的資料彙集操作. 並且檢視表會隨著資料表的更新, 更新至最新的狀態, 主要因為檢視表是儲存 SELECT 敘述的緣故.
* 將經常使用的 SELECT 敘述製作成檢視表, 便能重複利用
* 建立檢視表時, 需要使用 CREATE VIEW 敘述, 雖然可以使用檢視表建立檢視表(也就是所謂的多層檢視表), 但是這樣<font color = red>會使得資料庫的效能變低, 建議別太常使用.</font>
* 檢視表在使用上具有「不能使用 ORDER BY 子句」以及「可透過檢視表更新資料, 但有限制條件」等限制事項
  * SELECT 子句中沒有 DISTINCT 關鍵字
  * FROM 子句中只有一個資料表
  * 沒有使用 GROUP BY 子句
  * 沒有使用 HAVING 子句
  * 因為資料表和檢視表的關係為一致的, 所以一個變化另外一個也必須變化, 如果有以上幾個子句, 則改變檢視表, 資料表會無法得知如何修改. 所以<font color = red>資料表無法透過有彙總動作的檢視表更新資料.</font>
* 在 FROM 子句中指定檢視表進行查詢時, 會先執行建立檢視表的 SELECT 敘述, 再將其結果當作 FROM 子句所指定的資料來源.P.5-7~8
* 刪除檢視表時, 需使用 DROP VIEW 敘述

### <font size = 5>檢視表的建立方式</font>

```SQL
CREATE VIEW <檢視表名稱> (<檢視表欄位名稱1>, ...)
AS
<SELECT 敘述>
```

例子 : 嘗試建立檢視表

```SQL
-- 還原資料
START TRANSACTION;

DELETE FROM Shohin;
INSERT INTO Shohin VALUES ('0001', 'T侐', '衣物', 1000, 500, '2009-09-20');
INSERT INTO Shohin VALUES ('0002', '打孔機', '辦公用品', 500, 320, '2009-09-11');
INSERT INTO Shohin VALUES ('0003', '襯衫', '衣物', 4000, 2800, NULL);
INSERT INTO Shohin VALUES ('0004', '菜刀', '廚房用品', 3000, 2800, '2009-09-20');
INSERT INTO Shohin VALUES ('0005', '壓力鍋', '廚房用品', 6800, 5000, '2009-01-15');
INSERT INTO Shohin VALUES ('0006', '叉子', '廚房用品', 500, NULL, '2009-09-20');
INSERT INTO Shohin VALUES ('0007', '刨絲器', '廚房用品', 880, 790, '2008-04-28');
INSERT INTO Shohin VALUES ('0008', '鋼珠筆', '辦公用品', 100, NULL, '2009-11-11');

COMMIT;
```

```SQL
/*
建立檢視表
此檢視表為以商品分類為群組, 計算各組的數量
*/
CREATE VIEW ShohinSum (shohin_catalg, cnt_shohin)
AS
SELECT
    Shohin_catalg,
    COUNT(*)
FROM
    shohin
GROUP BY shohin_catalg;
```

![結果](https://imgur.com/MVbbAK5.jpg)

```SQL
-- 使用檢視表查看資料
SELECT
    *
FROM
    ShohinSum;
```

多層檢視表 : 使用檢視表製作檢視表

```SQL
CREATE VIEW ShohinSumJim(
    shohin_catalg,
    cnt_shohin
)
AS
SELECT
    shohin_catalg,
    cnt_shohin
FROM
    ShohinSum
WHERE
    shohin_catalg = '辦公用品';
```

![結果](https://imgur.com/Cox2yqg.jpg)

---

例子 : 可更新資料表的檢視表

```SQL
CREATE VIEW ShohinJim(
    shohin_id,
    shohin_name,
    shohin_catalg,
    sell_price,
    buying_price,
    reg_date
)
AS
SELECT
    *
FROM
    Shohin
WHERE
    shohin_catalg = '辦公用品';
```

```SQL
-- 從檢視表新增資料
INSERT INTO ShohinJim
VALUES
    ('0009', '印章', '辦公用品', 95, 10, '2009-11-30');
    -- 當然這邊只能打辦公用品, 因為製作 VIEW 時, 我們的限制條件就是辦公用品.
```

![結果1](https://imgur.com/WM4ROD3.jpg)
![結果2](https://imgur.com/aToPEZL.jpg)

---

### <font size = 5> 刪除檢視表 </font>

刪除檢視表語法和刪除資料表類似

```SQL
DROP VIEW <檢視表名稱>;
```

例子

```SQL
DROP VIEW ShohinSum;
```